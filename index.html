<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚀 쿠팡 핫딜 & 숨겨진 최저가 파인더</title>
    
    <!-- 1. Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React, ReactDOM, Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f9;
        }
        /* 쿠팡 파트너스 광고 스타일 시뮬레이션 */
        .ad-block {
            transition: transform 0.3s ease;
        }
        .ad-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <!-- React App이 마운트될 Root 요소 -->
    <div id="root"></div>

    <!-- 3. React/JSX 코드 (type="text/babel" 필수) -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, Fragment } = React;
        const ReactDOM = window.ReactDOM;

        // ------------------------------------
        // 1. 모의 데이터: 쿠팡 핫딜 정보 시뮬레이션 (최저가 비교 대신 쿠팡 내 최고 딜 강조)
        // ------------------------------------
        const MOCK_DEALS_DATA = [
            // sourceSite를 쿠팡의 딜 조건(로켓와우, 쿠폰 등)으로 변경하여 차별화
            { id: 1, productName: 'LG 퓨리케어 공기청정기', currentPrice: 450000, originalPrice: 600000, sourceSite: '로켓와우 특가 (15% 추가 할인)', link: '#', savings: 150000, color: 'blue', image: 'https://placehold.co/80x80/3b82f6/ffffff?text=공기청정기' },
            { id: 2, productName: '삼성 갤럭시 워치 6', currentPrice: 289000, originalPrice: 329000, sourceSite: '오늘의 골드박스 딜', link: '#', savings: 40000, color: 'red', image: 'https://placehold.co/80x80/ef4444/ffffff?text=워치' },
            { id: 3, productName: '아이패드 프로 11인치 256GB', currentPrice: 998000, originalPrice: 1200000, sourceSite: '카드 무이자 24개월 (단독)', link: '#', savings: 202000, color: 'green', image: 'https://placehold.co/80x80/10b981/ffffff?text=아이패드' },
            { id: 4, productName: '자취 필수템 미니 인덕션', currentPrice: 35000, originalPrice: 45000, sourceSite: '쿠폰 적용 최저가', link: '#', savings: 10000, color: 'blue', image: 'https://placehold.co/80x80/3b82f6/ffffff?text=인덕션' },
            { id: 5, productName: '다이슨 무선 청소기 V15', currentPrice: 725000, originalPrice: 850000, sourceSite: '새벽 배송 단독 특가', link: '#', savings: 125000, color: 'red', image: 'https://placehold.co/80x80/ef4444/ffffff?text=청소기' },
        ];

        // ------------------------------------
        // 2. 핵심 컴포넌트: 쿠팡 파트너스 광고 시뮬레이션
        // ------------------------------------
        const CoupangAd = ({ title, description, color, image, link }) => {
            const baseColor = color === 'blue' ? 'bg-blue-500 border-blue-700' : 
                              color === 'red' ? 'bg-red-500 border-red-700' : 
                              'bg-green-500 border-green-700';
            const hoverColor = color === 'blue' ? 'hover:bg-blue-600' : 
                               color === 'red' ? 'hover:bg-red-600' : 
                               'hover:bg-green-600';

            return (
                <div className="ad-block p-4 rounded-xl shadow-xl border-2 bg-white transition duration-300 transform hover:scale-[1.01] my-6">
                    <div className="text-center text-xs font-bold text-gray-500 mb-2">
                        💰 쿠팡 파트너스 추천 상품 (광고)
                    </div>
                    <div className="flex flex-col sm:flex-row items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <img 
                            src={image} 
                            alt="[광고 상품 이미지]" 
                            className="w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover mb-3 sm:mb-0"
                        />
                        <div className="flex-grow mx-4 text-center sm:text-left">
                            <h3 className="text-lg font-extrabold text-gray-900">{title}</h3>
                            <p className="text-sm text-gray-600">{description}</p>
                        </div>
                        <a 
                            href={link}
                            target="_blank"
                            rel="noopener noreferrer"
                            className={`mt-3 sm:mt-0 px-6 py-3 text-white font-bold rounded-full transition duration-200 shadow-lg ${baseColor} ${hoverColor}`}
                        >
                            지금 쿠팡에서 확인
                        </a>
                    </div>
                </div>
            );
        };

        // ------------------------------------
        // 3. 딜 항목 컴포넌트 (DealItem)
        // ------------------------------------

        const DealItem = ({ deal }) => {
            const savingsPercent = Math.round((deal.savings / deal.originalPrice) * 100);
            const priceFormatted = deal.currentPrice.toLocaleString('ko-KR');
            const originalPriceFormatted = deal.originalPrice.toLocaleString('ko-KR');

            return (
                <div className="bg-white p-6 rounded-xl shadow-md flex flex-col md:flex-row items-start md:items-center justify-between mb-4 transition duration-200 hover:shadow-lg border-l-4 border-red-500">
                    
                    {/* 상품 정보 */}
                    <div className="flex items-center flex-grow mb-4 md:mb-0">
                        <img 
                            src={deal.image} 
                            alt={`[${deal.productName} 이미지]`}
                            className="w-16 h-16 object-cover rounded-md mr-4 shadow"
                        />
                        <div>
                            <h3 className="text-xl font-bold text-gray-800 mb-1">{deal.productName}</h3>
                            <div className="text-sm text-gray-500">
                                <span className="line-through mr-2">쿠팡 정가: {originalPriceFormatted}원</span>
                                <span className="font-bold text-red-600">{savingsPercent}% 할인</span>
                            </div>
                        </div>
                    </div>

                    {/* 가격 및 버튼 */}
                    <div className="flex flex-col items-end w-full md:w-auto">
                        <p className="text-2xl font-extrabold text-blue-600">{priceFormatted}원</p>
                        <p className="text-xs text-gray-700 font-semibold mb-2">적용 조건: {deal.sourceSite}</p>
                        <a 
                            href={deal.link}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="px-4 py-2 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition duration-200 shadow-md w-full text-center"
                        >
                            쿠팡에서 딜 보러가기 &rarr;
                        </a>
                    </div>
                </div>
            );
        };

        // ------------------------------------
        // 4. 메인 앱 컴포넌트
        // ------------------------------------

        const App = () => {
            const [deals, setDeals] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState(''); // 검색어 상태 추가

            useEffect(() => {
                // 실제 백엔드 API 엔드포인트입니다.
                const API_ENDPOINT = 'https://your-server-api.com/v1/coupang-hotdeals'; 

                const fetchData = async () => {
                    setIsLoading(true);
                    try {
                        // -------------------------------------------------------------
                        // 1. **실제 배포 시:** 아래 주석을 풀고 API_ENDPOINT를 사용하세요.
                        // const response = await fetch(API_ENDPOINT);
                        // if (!response.ok) throw new Error('API Response Error');
                        // const apiData = await response.json();
                        
                        // 2. **현재 테스트를 위해:** MOCK_DEALS_DATA를 사용합니다.
                        const apiData = MOCK_DEALS_DATA; 
                        // -------------------------------------------------------------

                        // 데이터가 배열 형태라고 가정하고 처리
                        const sortedDeals = [...apiData].sort((a, b) => b.savings - a.savings);
                        setDeals(sortedDeals);

                    } catch (error) {
                        console.error("Error fetching deals:", error);
                    } finally {
                        setTimeout(() => {
                            setIsLoading(false);
                        }, 500); 
                    }
                };

                fetchData();
                // 운영 시: 일정 시간마다 (예: 10분마다) 데이터를 새로고침하도록 설정
                // const intervalId = setInterval(fetchData, 600000); 

                // return () => clearInterval(intervalId);
            }, []);
            
            // 검색어 필터링 로직 (useMemo로 최적화)
            const filteredDeals = useMemo(() => {
                const lowerCaseSearch = searchTerm.toLowerCase();
                if (!lowerCaseSearch) {
                    return deals; // 검색어가 없으면 전체 목록 반환
                }

                return deals.filter(deal => {
                    // 상품명 또는 핫딜 조건에 검색어가 포함되는지 확인
                    return deal.productName.toLowerCase().includes(lowerCaseSearch) ||
                           deal.sourceSite.toLowerCase().includes(lowerCaseSearch);
                });
            }, [deals, searchTerm]);


            // 검색 버튼 클릭 시 (또는 Enter 키 입력 시) 실행될 함수
            const handleSearchSubmit = () => {
                // setSearchTerm이 이미 onChange에서 호출되고 있으므로, 
                // 이 함수는 주로 사용자에게 검색이 완료되었음을 알리는 역할을 합니다.
                // 즉, 별도의 로직 없이도 필터링은 이미 작동 중입니다.
                // 만약 즉시 검색을 원치 않는다면, setSearchTerm 로직을 여기에 넣어야 합니다.
                console.log(`Searching for: ${searchTerm}`);
            };


            return (
                <div className="min-h-screen bg-gray-100">
                    {/* 헤더 */}
                    <header className="bg-white shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
                            <h1 className="text-3xl font-extrabold text-red-600 tracking-tight">
                                🚀 쿠팡 핫딜 & 숨겨진 최저가 파인더
                            </h1>
                            <div className="text-right text-sm text-gray-700">
                                <p className="font-semibold">쿠팡 API 기반 실시간 딜 업데이트</p>
                                <p className="text-xs text-gray-500">놓치면 아쉬운 쿠팡 최고의 딜만 모았습니다.</p>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">

                            {/* 메인 콘텐츠 영역 (딜 목록 및 광고) */}
                            <section className="lg:col-span-2 space-y-8">
                                
                                {/* 검색 입력창 및 버튼 (flex로 배치) */}
                                <div className="mb-6 flex space-x-2">
                                    <input
                                        type="text"
                                        placeholder="상품명 또는 핫딜 조건을 검색해보세요..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        onKeyDown={(e) => {
                                            // 엔터 키 입력 시 검색 동작 실행 (useMemo로 이미 즉시 필터링 되지만, 관습적으로 추가)
                                            if (e.key === 'Enter') {
                                                handleSearchSubmit();
                                            }
                                        }}
                                        className="flex-grow p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-red-500 shadow-inner text-lg"
                                    />
                                    <button
                                        onClick={handleSearchSubmit}
                                        className="bg-red-500 text-white p-4 rounded-xl font-bold hover:bg-red-600 transition duration-200 shadow-md flex items-center justify-center text-lg whitespace-nowrap"
                                        title="검색 시작"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                                        <span className="hidden sm:inline ml-2">검색</span>
                                    </button>
                                </div>
                                
                                <h2 className="text-3xl font-bold text-gray-800 border-b pb-2">
                                    오늘의 쿠팡 최고 할인율 딜 Top {filteredDeals.length}개
                                </h2>
                                
                                {isLoading ? (
                                    <div className="p-8 text-center bg-white rounded-xl shadow-md">
                                        <div className="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-3"></div>
                                        <p className="text-xl font-semibold text-gray-700">
                                            쿠팡 API에서 핫딜 정보를 가져오는 중입니다...
                                        </p>
                                    </div>
                                ) : filteredDeals.length === 0 ? (
                                     <div className="p-8 text-center bg-yellow-100 rounded-xl shadow-md">
                                        <p className="text-xl font-semibold text-yellow-800">
                                            검색 결과가 없습니다. 다른 검색어로 시도해보세요!
                                        </p>
                                    </div>
                                ) : (
                                    filteredDeals.map((deal, index) => (
                                        <Fragment key={deal.id}>
                                            <DealItem deal={deal} />
                                            {/* 딜 2개마다 광고 삽입하여 노출 극대화 */}
                                            {(index + 1) % 2 === 0 && (
                                                <CoupangAd
                                                    title={`놓치면 후회할 쿠팡의 특가 상품!`}
                                                    description={`지금 가장 주목받는 베스트 상품을 확인하세요.`}
                                                    color={index % 4 === 0 ? 'blue' : 'green'}
                                                    image={`https://placehold.co/80x80/${index % 4 === 0 ? '3b82f6' : '10b981'}/ffffff?text=AD-${index + 1}`}
                                                    link="#" // 실제 쿠팡 파트너스 링크 삽입
                                                />
                                            )}
                                        </Fragment>
                                    ))
                                )}
                            </section>

                            {/* 사이드바 영역 (핵심 광고 배치) */}
                            <aside className="space-y-8">
                                {/* 핵심 광고 1: 대형 배너 - 딜과 연관된 카테고리 광고 */}
                                <CoupangAd
                                    title="⏰ 쿠팡 와우 회원 전용 특가"
                                    description="와우 회원이시라면 지금 바로 확인하세요! (광고)"
                                    color="red"
                                    image="https://placehold.co/80x80/ef4444/ffffff?text=와우"
                                    link="#" // 실제 쿠팡 파트너스 링크 삽입
                                />

                                {/* 추가 정보/공지 */}
                                <div className="bg-white p-6 rounded-xl shadow-lg border-t-4 border-gray-300">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4 border-b pb-2">이용 가이드</h3>
                                    <ul className="text-sm text-gray-600 space-y-2 list-disc list-inside">
                                        <li>가격 정보는 쿠팡 API를 기반으로 업데이트됩니다.</li>
                                        <li>'딜 보러가기' 클릭 시 쿠팡 상품 페이지로 이동합니다.</li>
                                        <li>모든 광고 배너는 쿠팡 파트너스 활동으로 수수료를 받습니다.</li>
                                    </ul>
                                </div>
                                
                                {/* 핵심 광고 2: 일반 상품 광고 */}
                                <CoupangAd
                                    title="✨ 쿠팡 신상품 할인 카테고리"
                                    description="매일 업데이트되는 새로운 할인 품목을 놓치지 마세요."
                                    color="blue"
                                    image="https://placehold.co/80x80/3b82f6/ffffff?text=신상"
                                    link="#" // 실제 쿠팡 파트너스 링크 삽입
                                />

                            </aside>

                        </div>
                    </main>

                    {/* 푸터 */}
                    <footer className="bg-gray-800 text-white mt-12">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-sm">
                            <p>&copy; 2025 쿠팡 핫딜 파인더. All rights reserved.</p>
                            <p className="mt-2 text-xs text-gray-400">
                                본 사이트에는 수익의 일환으로 쿠팡 파트너스 링크가 포함되어 있으며, 구매 시 일정액의 수수료를 제공받습니다.
                            </p>
                        </div>
                    </footer>
                </div>
            );
        }

        // React 앱을 DOM에 마운트합니다.
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
